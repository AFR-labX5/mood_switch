<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Emotion Tracker Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  body {
    display: flex;
    flex-direction: column;
    align-items: center;
    font-family: Arial, sans-serif;
    color: white;
    text-align: center;
    padding: 20px;
    min-height: 100vh;
    transition: background-color 0.5s;
  }
  h1 { font-size: 2rem; margin-bottom: 10px; }
  #timer, #startTimestamp { font-size: 1.2rem; margin-bottom: 10px; }
  #moodImage {
    width: 200px;
    height: 200px;
    margin-bottom: 20px;
    border-radius: 15px;
    object-fit: cover;
    transition: filter 0.3s;
  }
  .buttons { display: flex; gap: 15px; margin-bottom: 20px; flex-wrap: wrap; justify-content:center; }
  button {
    padding: 15px 35px;
    font-size: 1rem;
    border: none;
    border-radius: 15px;
    cursor: pointer;
    transition: transform 0.2s;
  }
  button:active { transform: scale(0.95); }
  .positive { background-color: #007bff; color: white; }
  .anger { background-color: #B22222; color: white; }
  .negative { background-color: #333333; color: white; }
  .fear { background-color: #555555; color: white; }
  .sad { background-color: #87CEEB; color: black; }
  .tired { background-color: #C19A6B; color: black; }
  .neutral { background-color: #FFC107; color: black; }
  .reset { background-color: #6c757d; color: white; }
  #log {
    width: 100%;
    max-width: 600px;
    background: rgba(0,0,0,0.2);
    padding: 15px;
    border-radius: 10px;
    text-align: left;
    max-height: 250px;
    overflow-y: auto;
    margin-bottom: 20px;
  }
  canvas { max-width: 600px; margin-bottom: 30px; background: rgba(255,255,255,0.1); border-radius: 10px; padding:10px; }
</style>
</head>
<body>

<h1 id="moodText">Choose Your Mood</h1>
<div id="startTimestamp">Start Time: â€”</div>
<img id="moodImage" src="" alt="Mood Image">
<div id="timer">00:00</div>

<div class="buttons">
  <button class="positive" onclick="setMood('positive')">Positive</button>
  <button class="anger" onclick="setMood('anger')">Anger</button>
  <button class="negative" onclick="setMood('negative')">Negative</button>
  <button class="fear" onclick="setMood('fear')">Fear</button>
  <button class="sad" onclick="setMood('sad')">Sad</button>
  <button class="tired" onclick="setMood('tired')">Tired</button>
  <button class="neutral" onclick="setMood('neutral')">Neutral</button>
  <button class="reset" onclick="resetAll()">Reset All</button>
</div>

<div id="log">
  <h2>Last 10 Mood Sessions</h2>
  <ul id="logList"></ul>
  <h2>Cumulative Time</h2>
  <ul id="timeList"></ul>
  <h2>Button Count</h2>
  <ul id="countList"></ul>
</div>

<h2>Frequency (%)</h2>
<canvas id="freqChart"></canvas>
<h2>Duration (%)</h2>
<canvas id="durationChart"></canvas>

<script>
let currentMood = null;
let startTime = null;
let timerInterval = null;

const moods = {
  positive: { color:'#007bff', text:'Positive ðŸ˜Š', image:'https://4kwallpapers.com/images/walls/thumbs_3t/21426.jpg' },
  anger: { color:'#B22222', text:'Anger ðŸ”¥', image:'https://images6.alphacoders.com/917/thumb-1920-917631.png' },
  negative: { color:'#333333', text:'Negative âš¡', image:'https://www.topaccountingdegrees.org/wp-content/uploads/2020/06/Can-I-Combine-an-Accounting-Degree-With-a-Law-Degree-1024x684.jpg', blur:false },
  fear: { color:'#555555', text:'Fear ðŸ˜¨', image:'https://wallpapers.com/images/high/shaggy-in-a-flying-hovercraft-from-scooby-doo-animated-series-lezgt5jujj84ywj1.webp' },
  sad: { color:'#87CEEB', text:'Sad ðŸ˜¢', image:'https://s1.bwallpapers.com/thumbs2/2014/03/06/the-simpsons-free-backgrounds_103841965.jpg' },
  tired: { color:'#C19A6B', text:'Tired ðŸ˜´', image:'https://static01.nyt.com/images/2022/01/29/autossell/clip-2/clip-2-superJumbo-v3.jpg' },
  neutral: { color:'#FFC107', text:'Neutral â˜€ï¸', image:'https://images.alphacoders.com/699/thumb-1920-699582.jpg' }
};

let moodLog = JSON.parse(localStorage.getItem('moodLog')) || [];
let cumulativeTime = JSON.parse(localStorage.getItem('cumulativeTime')) || Object.fromEntries(Object.keys(moods).map(k=>[k,0]));
let moodCount = JSON.parse(localStorage.getItem('moodCount')) || Object.fromEntries(Object.keys(moods).map(k=>[k,0]));

window.onload = () => {
  const savedMood = localStorage.getItem('currentMood');
  const savedStart = parseInt(localStorage.getItem('moodStartTime'));
  if(savedMood && savedStart) {
    currentMood = savedMood;
    startTime = savedStart;
    document.getElementById('startTimestamp').textContent = `Start Time: ${new Date(startTime).toLocaleString()}`;
    updateMoodAppearance(currentMood);
    startTimer();
  }
  renderAll();
};

function setMood(mood) {
  if(currentMood) recordCurrentMood();
  currentMood = mood;
  startTime = Date.now();
  localStorage.setItem('currentMood', currentMood);
  localStorage.setItem('moodStartTime', startTime);
  document.getElementById('startTimestamp').textContent = `Start Time: ${new Date(startTime).toLocaleString()}`;
  moodCount[mood]++;
  updateMoodAppearance(mood);
  startTimer();
  saveAll();
  renderAll();
}

function updateMoodAppearance(mood) {
  const m = moods[mood];
  document.body.style.backgroundColor = m.color;
  document.getElementById('moodText').textContent = m.text;
  const img = document.getElementById('moodImage');
  img.src = m.image;
  img.style.filter = m.blur ? 'blur(4px)' : 'none';
}

function startTimer() {
  if(timerInterval) clearInterval(timerInterval);
  timerInterval = setInterval(() => {
    const elapsed = Math.floor((Date.now() - startTime)/1000);
    document.getElementById('timer').textContent = formatTime(elapsed);
    renderCharts();
  }, 1000);
}

function recordCurrentMood() {
  const elapsed = Math.floor((Date.now() - startTime)/1000);
  moodLog.push({ mood: currentMood, duration: elapsed, timestamp: new Date(startTime).toLocaleString() });
  cumulativeTime[currentMood] += elapsed;
  saveAll();
}

function resetAll() {
  if(timerInterval) clearInterval(timerInterval);
  currentMood = null;
  startTime = null;
  document.getElementById('timer').textContent = "00:00";
  document.getElementById('moodText').textContent = "Choose Your Mood";
  document.getElementById('moodImage').src = "";
  document.body.style.backgroundColor = "";
  document.getElementById('startTimestamp').textContent = "Start Time: â€”";
  moodLog = [];
  cumulativeTime = Object.fromEntries(Object.keys(moods).map(k=>[k,0]));
  moodCount = Object.fromEntries(Object.keys(moods).map(k=>[k,0]));
  localStorage.clear();
  renderAll();
}

function saveAll() {
  localStorage.setItem('moodLog', JSON.stringify(moodLog));
  localStorage.setItem('cumulativeTime', JSON.stringify(cumulativeTime));
  localStorage.setItem('moodCount', JSON.stringify(moodCount));
}

function renderAll() {
  renderLog();
  renderTime();
  renderCount();
  renderCharts();
}

function renderLog() {
  const logList = document.getElementById('logList');
  logList.innerHTML = '';
  moodLog.slice(-10).reverse().forEach(e => {
    const li = document.createElement('li');
    li.textContent = `[${e.timestamp}] ${e.mood.toUpperCase()} â€“ ${formatTime(e.duration)}`;
    logList.appendChild(li);
  });
}

function renderTime() {
  const timeList = document.getElementById('timeList');
  timeList.innerHTML = '';
  for(const mood in cumulativeTime) {
    const li = document.createElement('li');
    li.textContent = `${mood.charAt(0).toUpperCase()+mood.slice(1)}: ${formatTime(cumulativeTime[mood])}`;
    timeList.appendChild(li);
  }
}

function renderCount() {
  const countList = document.getElementById('countList');
  countList.innerHTML = '';
  for(const mood in moodCount) {
    const li = document.createElement('li');
    li.textContent = `${mood.charAt(0).toUpperCase()+mood.slice(1)}: ${moodCount[mood]}`;
    countList.appendChild(li);
  }
}

function formatTime(seconds) {
  const mins = String(Math.floor(seconds / 60)).padStart(2,'0');
  const secs = String(seconds % 60).padStart(2,'0');
  return `${mins}:${secs}`;
}

let freqChart, durationChart;
function renderCharts() {
  const labels = Object.keys(moods).map(k => k.charAt(0).toUpperCase()+k.slice(1));
  const freqVals = Object.values(moodCount);
  const durVals = Object.values(cumulativeTime);
  const totalF = freqVals.reduce((a,b)=>a+b,0)||1;
  const totalD = durVals.reduce((a,b)=>a+b,0)||1;
  const freqPct = freqVals.map(v=>((v/totalF)*100).toFixed(1));
  const durPct = durVals.map(v=>((v/totalD)*100).toFixed(1));
  const colors = Object.values(moods).map(m=>m.color);
  if(freqChart) freqChart.destroy();
  if(durationChart) durationChart.destroy();
  freqChart = new Chart(document.getElementById('freqChart').getContext('2d'), {
    type:'bar',
    data:{ labels, datasets:[{ label:'Frequency (%)', data: freqPct, backgroundColor: colors }]},
    options:{ responsive:true, plugins:{legend:{display:false}}, scales:{y:{beginAtZero:true,max:100,ticks:{callback:v=>v+'%'}}}}
  });
  durationChart = new Chart(document.getElementById('durationChart').getContext('2d'), {
    type:'bar',
    data:{ labels, datasets:[{ label:'Duration (%)', data: durPct, backgroundColor: colors }]},
    options:{ responsive:true, plugins:{legend:{display:false}}, scales:{y:{beginAtZero:true,max:100,ticks:{callback:v=>v+'%'}}}}
  });
}

window.addEventListener('beforeunload', () => { if(currentMood) recordCurrentMood(); });

</script>
</body>
</html>

